"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("react");var t,n={exports:{}},r={};var i,s={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"===process.env.NODE_ENV?n.exports=function(){if(t)return r;t=1;var n=e,i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var r,s={},d=null,c=null;for(r in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:d,ref:c,props:s,_owner:a.current}}return r.Fragment=s,r.jsx=d,r.jsxs=d,r}():n.exports=(i||(i=1,"production"!==process.env.NODE_ENV&&function(){var t,n=e,r=Symbol.for("react.element"),i=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),m=Symbol.iterator,v=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];!function(e,t,n){var r=v.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var i=n.map(function(e){return String(e)});i.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,i)}("error",e,n)}function E(e){return e.displayName||"Context"}function w(e){if(null==e)return null;if("number"==typeof e.tag&&b("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case o:return"Fragment";case i:return"Portal";case l:return"Profiler";case a:return"StrictMode";case p:return"Suspense";case h:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case c:return E(e)+".Consumer";case d:return E(e._context)+".Provider";case u:return function(e,t,n){var r=e.displayName;if(r)return r;var i=t.displayName||t.name||"";return""!==i?n+"("+i+")":n}(e,e.render,"ForwardRef");case f:var t=e.displayName||null;return null!==t?t:w(e.type)||"Memo";case g:var n=e,r=n._payload,s=n._init;try{return w(s(r))}catch(y){return null}}return null}t=Symbol.for("react.module.reference");var k,I,C,O,S,x,T,R=Object.assign,_=0;function M(){}M.__reactDisabledLog=!0;var A,$=v.ReactCurrentDispatcher;function B(e,t,n){if(void 0===A)try{throw Error()}catch(i){var r=i.stack.trim().match(/\n( *(at )?)/);A=r&&r[1]||""}return"\n"+A+e}var F,L=!1,N="function"==typeof WeakMap?WeakMap:Map;function j(e,t){if(!e||L)return"";var n,r=F.get(e);if(void 0!==r)return r;L=!0;var i,s=Error.prepareStackTrace;Error.prepareStackTrace=void 0,i=$.current,$.current=null,function(){if(0===_){k=console.log,I=console.info,C=console.warn,O=console.error,S=console.group,x=console.groupCollapsed,T=console.groupEnd;var e={configurable:!0,enumerable:!0,value:M,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}_++}();try{if(t){var o=function(){throw Error()};if(Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(o,[])}catch(f){n=f}Reflect.construct(e,[],o)}else{try{o.call()}catch(f){n=f}e.call(o.prototype)}}else{try{throw Error()}catch(f){n=f}e()}}catch(g){if(g&&n&&"string"==typeof g.stack){for(var a=g.stack.split("\n"),l=n.stack.split("\n"),d=a.length-1,c=l.length-1;d>=1&&c>=0&&a[d]!==l[c];)c--;for(;d>=1&&c>=0;d--,c--)if(a[d]!==l[c]){if(1!==d||1!==c)do{if(d--,--c<0||a[d]!==l[c]){var u="\n"+a[d].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),"function"==typeof e&&F.set(e,u),u}}while(d>=1&&c>=0);break}}}finally{L=!1,$.current=i,function(){if(0===--_){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:R({},e,{value:k}),info:R({},e,{value:I}),warn:R({},e,{value:C}),error:R({},e,{value:O}),group:R({},e,{value:S}),groupCollapsed:R({},e,{value:x}),groupEnd:R({},e,{value:T})})}_<0&&b("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=s}var p=e?e.displayName||e.name:"",h=p?B(p):"";return"function"==typeof e&&F.set(e,h),h}function D(e,t,n){if(null==e)return"";if("function"==typeof e)return j(e,!(!(r=e.prototype)||!r.isReactComponent));var r;if("string"==typeof e)return B(e);switch(e){case p:return B("Suspense");case h:return B("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case u:return j(e.render,!1);case f:return D(e.type,t,n);case g:var i=e,s=i._payload,o=i._init;try{return D(o(s),t,n)}catch(a){}}return""}F=new N;var P=Object.prototype.hasOwnProperty,U={},H=v.ReactDebugCurrentFrame;function z(e){if(e){var t=e._owner,n=D(e.type,e._source,t?t.type:null);H.setExtraStackFrame(n)}else H.setExtraStackFrame(null)}var V=Array.isArray;function Q(e){return V(e)}function W(e){return""+e}function Y(e){if(function(e){try{return W(e),!1}catch(t){return!0}}(e))return b("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),W(e)}var q,K,X=v.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function G(e,t,n,i,s){var o,a={},l=null,d=null;for(o in void 0!==n&&(Y(n),l=""+n),function(e){if(P.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(t)&&(Y(t.key),l=""+t.key),function(e){if(P.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}(t)&&(d=t.ref,function(e){"string"==typeof e.ref&&X.current}(t)),t)P.call(t,o)&&!J.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps){var c=e.defaultProps;for(o in c)void 0===a[o]&&(a[o]=c[o])}if(l||d){var u="function"==typeof e?e.displayName||e.name||"Unknown":e;l&&function(e,t){var n=function(){q||(q=!0,b("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"key",{get:n,configurable:!0})}(a,u),d&&function(e,t){var n=function(){K||(K=!0,b("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"ref",{get:n,configurable:!0})}(a,u)}return function(e,t,n,i,s,o,a){var l={$$typeof:r,type:e,key:t,ref:n,props:a,_owner:o,_store:{}};return Object.defineProperty(l._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(l,"_self",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.defineProperty(l,"_source",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.freeze&&(Object.freeze(l.props),Object.freeze(l)),l}(e,l,d,s,i,X.current,a)}var Z,ee=v.ReactCurrentOwner,te=v.ReactDebugCurrentFrame;function ne(e){if(e){var t=e._owner,n=D(e.type,e._source,t?t.type:null);te.setExtraStackFrame(n)}else te.setExtraStackFrame(null)}function re(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}function ie(){if(ee.current){var e=w(ee.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}Z=!1;var se={};function oe(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var n=function(e){var t=ie();if(!t){var n="string"==typeof e?e:e.displayName||e.name;n&&(t="\n\nCheck the top-level render call using <"+n+">.")}return t}(t);if(!se[n]){se[n]=!0;var r="";e&&e._owner&&e._owner!==ee.current&&(r=" It was passed a child from "+w(e._owner.type)+"."),ne(e),b('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,r),ne(null)}}}function ae(e,t){if("object"==typeof e)if(Q(e))for(var n=0;n<e.length;n++){var r=e[n];re(r)&&oe(r,t)}else if(re(e))e._store&&(e._store.validated=!0);else if(e){var i=function(e){if(null===e||"object"!=typeof e)return null;var t=m&&e[m]||e["@@iterator"];return"function"==typeof t?t:null}(e);if("function"==typeof i&&i!==e.entries)for(var s,o=i.call(e);!(s=o.next()).done;)re(s.value)&&oe(s.value,t)}}function le(e){var t,n=e.type;if(null!=n&&"string"!=typeof n){if("function"==typeof n)t=n.propTypes;else{if("object"!=typeof n||n.$$typeof!==u&&n.$$typeof!==f)return;t=n.propTypes}if(t){var r=w(n);!function(e,t,n,r,i){var s=Function.call.bind(P);for(var o in e)if(s(e,o)){var a=void 0;try{if("function"!=typeof e[o]){var l=Error((r||"React class")+": "+n+" type `"+o+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[o]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw l.name="Invariant Violation",l}a=e[o](t,o,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(d){a=d}!a||a instanceof Error||(z(i),b("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,o,typeof a),z(null)),a instanceof Error&&!(a.message in U)&&(U[a.message]=!0,z(i),b("Failed %s type: %s",n,a.message),z(null))}}(t,e.props,"prop",r,e)}else void 0===n.PropTypes||Z||(Z=!0,b("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",w(n)||"Unknown"));"function"!=typeof n.getDefaultProps||n.getDefaultProps.isReactClassApproved||b("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}var de={};function ce(e,n,i,s,m,v){var E=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===l||e===a||e===p||e===h||e===y||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===f||e.$$typeof===d||e.$$typeof===c||e.$$typeof===u||e.$$typeof===t||void 0!==e.getModuleId)}(e);if(!E){var k,I="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(I+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports."),I+=ie(),null===e?k="null":Q(e)?k="array":void 0!==e&&e.$$typeof===r?(k="<"+(w(e.type)||"Unknown")+" />",I=" Did you accidentally export a JSX literal instead of a component?"):k=typeof e,b("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",k,I)}var C=G(e,n,i,m,v);if(null==C)return C;if(E){var O=n.children;if(void 0!==O)if(s)if(Q(O)){for(var S=0;S<O.length;S++)ae(O[S],e);Object.freeze&&Object.freeze(O)}else b("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ae(O,e)}if(P.call(n,"key")){var x=w(e),T=Object.keys(n).filter(function(e){return"key"!==e}),R=T.length>0?"{key: someKey, "+T.join(": ..., ")+": ...}":"{key: someKey}";de[x+R]||(b('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',R,x,T.length>0?"{"+T.join(": ..., ")+": ...}":"{}",x),de[x+R]=!0)}return e===o?function(e){for(var t=Object.keys(e.props),n=0;n<t.length;n++){var r=t[n];if("children"!==r&&"key"!==r){ne(e),b("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",r),ne(null);break}}null!==e.ref&&(ne(e),b("Invalid attribute `ref` supplied to `React.Fragment`."),ne(null))}(C):le(C),C}var ue=function(e,t,n){return ce(e,t,n,!1)},pe=function(e,t,n){return ce(e,t,n,!0)};s.Fragment=o,s.jsx=ue,s.jsxs=pe}()),s);var o=n.exports;class a{constructor(e){this.registry={},this.observer=null,this.isDestroyed=!1,this.config=e,this.initializeObserver(),this.scanExistingElements()}getElementsForField(e,t){const n=[];for(const r of Object.values(this.registry))for(const i of r)i.fieldApiId===e&&i.locale===t&&n.push(i);return n}getElementsForEntry(e){const t=[];for(const n of Object.values(this.registry))for(const r of n)r.entryId===e&&t.push(r);return t}getElement(e,t,n){const r=this.createRegistryKey(e,t,n),i=this.registry[r];return(null==i?void 0:i[0])||null}refresh(){this.isDestroyed||this.scanExistingElements()}destroy(){var e;this.isDestroyed=!0,null==(e=this.observer)||e.disconnect(),this.registry={}}initializeObserver(){this.observer=new MutationObserver(e=>{var t;if(!this.isDestroyed)for(const n of e){if("childList"===n.type)for(const e of n.addedNodes)e.nodeType===Node.ELEMENT_NODE&&this.scanElement(e);"attributes"===n.type&&(null==(t=n.attributeName)?void 0:t.startsWith("data-hygraph-"))&&this.updateElementRegistration(n.target)}}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-hygraph-entry-id","data-hygraph-field-api-id","data-hygraph-field-locale"]})}scanExistingElements(){document.querySelectorAll("[data-hygraph-entry-id]").forEach(e=>this.scanElement(e))}scanElement(e){this.hasHygraphAttributes(e)&&this.registerElement(e);e.querySelectorAll("[data-hygraph-entry-id]").forEach(e=>this.registerElement(e))}hasHygraphAttributes(e){return e.hasAttribute("data-hygraph-entry-id")}registerElement(e){const t=e.getAttribute("data-hygraph-entry-id");if(!t)return;const n=e.getAttribute("data-hygraph-field-api-id")||void 0,r=e.getAttribute("data-hygraph-field-locale")||void 0,i={element:e,entryId:t,fieldApiId:n,locale:r,lastUpdated:Date.now()},s=this.createRegistryKey(t,n,r);this.registry[s]||(this.registry[s]=[]);const o=this.registry[s].findIndex(t=>t.element===e);o>=0?this.registry[s][o]=i:this.registry[s].push(i),this.config.debug&&console.log("[FieldRegistry] Registered element:",{entryId:t,fieldApiId:n,locale:r,element:e.tagName})}updateElementRegistration(e){this.unregisterElement(e),this.hasHygraphAttributes(e)&&this.registerElement(e)}unregisterElement(e){for(const[t,n]of Object.entries(this.registry)){const r=n.filter(t=>t.element!==e);0===r.length?delete this.registry[t]:this.registry[t]=r}}createRegistryKey(e,t,n){const r=[e];return t&&r.push(t),n&&r.push(n),r.join(":")}getStats(){const e=new Set,t=new Set;let n=0;for(const r of Object.values(this.registry)){n+=r.length;for(const n of r)e.add(n.entryId),n.fieldApiId&&t.add(`${n.entryId}:${n.fieldApiId}`)}return{totalElements:n,entriesCount:e.size,fieldsCount:t.size}}getRegistryKeys(){return Object.keys(this.registry)}}class l{constructor(e){this.isConnected=!1,this.studioOrigin=null,this.messageQueue=[],this.isDestroyed=!1,this.handleMessage=e=>{if(this.isDestroyed)return;if(!this.isOriginAllowed(e.origin))return void(this.config.debug&&console.log("[MessageBridge] Ignored message from disallowed origin:",e.origin));const t=e.data;this.isValidStudioMessage(t)?(this.config.debug&&console.log("[MessageBridge] Received message:",t),"init"===t.type&&this.handleConnection(e.origin),this.config.onMessage(t)):this.config.debug&&console.log("[MessageBridge] Ignored invalid message:",t)},this.config=e,this.setupMessageListener()}sendMessage(e){if(this.isDestroyed)return!1;if(!this.isConnected||!this.studioOrigin)return this.messageQueue.push(e),!1;try{return window.parent.postMessage(e,this.studioOrigin),this.config.debug&&console.log("[MessageBridge] Sent message:",e),!0}catch(t){return console.error("[MessageBridge] Failed to send message:",t),!1}}sendReadyMessage(e){if(this.isDestroyed)return!1;let t=!1;for(const r of this.config.allowedOrigins)try{window.parent.postMessage(e,r),this.config.debug&&console.log("[MessageBridge] Sent ready message to origin:",r,"message:",e),t=!0}catch(n){this.config.debug&&console.log("[MessageBridge] Failed to send ready message to origin:",r,"error:",n)}return t}isConnectedToStudio(){return this.isConnected}getStudioOrigin(){return this.studioOrigin}destroy(){this.isDestroyed=!0,this.isConnected=!1,this.studioOrigin=null,this.messageQueue=[],window.removeEventListener("message",this.handleMessage)}setupMessageListener(){this.config.debug&&console.log("[MessageBridge] Setting up message listener, allowed origins:",this.config.allowedOrigins),window.addEventListener("message",this.handleMessage),this.config.onReady&&setTimeout(()=>{this.config.onReady()},0)}isOriginAllowed(e){return this.config.allowedOrigins.includes(e)||this.config.allowedOrigins.some(t=>{if(t.includes("*")){const n=t.replace(/\*/g,".*");return new RegExp(`^${n}$`).test(e)}return!1})}isValidStudioMessage(e){if(!e||"object"!=typeof e)return!1;if("string"!=typeof e.type)return!1;if("number"!=typeof e.timestamp)return!1;switch(e.type){case"init":return"string"==typeof e.studioOrigin;case"field-update":return"string"==typeof e.entryId&&"string"==typeof e.fieldApiId&&"string"==typeof e.fieldType&&void 0!==e.newValue;case"focus-field":return"string"==typeof e.fieldApiId;case"bulk-update":return Array.isArray(e.changes);case"content-saved":return"string"==typeof e.entryId;case"disconnect":return!0;default:return!1}}handleConnection(e){this.isConnected||(this.isConnected=!0,this.studioOrigin=e,this.config.debug&&console.log("[MessageBridge] Connected to Studio:",e),this.flushMessageQueue())}flushMessageQueue(){const e=[...this.messageQueue];this.messageQueue=[];for(const t of e)this.sendMessage(t);this.config.debug&&e.length>0&&console.log(`[MessageBridge] Sent ${e.length} queued messages`)}}class d{constructor(e){this.updateQueue=new Map,this.isDestroyed=!1,this.config=e}async updateField(e){if(this.isDestroyed)return{success:!1,error:"ContentUpdater is destroyed"};try{const n=`${e.entryId}:${e.fieldApiId}:${e.locale||""}`;this.updateQueue.set(n,e),await this.delay(this.config.updateDelay||50);if(this.updateQueue.get(n)!==e)return{success:!0};this.updateQueue.delete(n);const r=this.findElements(e.entryId,e.fieldApiId,e.locale);if(0===r.length)return{success:!1,error:"No matching elements found"};let i=!1,s="";for(const o of r)try{await this.updateElement(o,e)}catch(t){i=!0,s=t instanceof Error?t.message:String(t),console.error("[ContentUpdater] Failed to update element:",t)}return i?{success:!1,error:s}:(this.config.debug&&console.log("[ContentUpdater] Updated field:",{entryId:e.entryId,fieldApiId:e.fieldApiId,locale:e.locale,elementsCount:r.length}),{success:!0,element:r[0]})}catch(t){const e=t instanceof Error?t.message:String(t);return console.error("[ContentUpdater] Update failed:",t),{success:!1,error:e}}}destroy(){this.isDestroyed=!0,this.updateQueue.clear()}findElements(e,t,n){const r=[];let i=`[data-hygraph-entry-id="${e}"]`;t&&(i+=`[data-hygraph-field-api-id="${t}"]`),n&&(i+=`[data-hygraph-field-locale="${n}"]`);const s=document.querySelectorAll(i);return r.push(...Array.from(s)),r}async updateElement(e,t){switch(t.fieldType){case"STRING":case"ID":case"ENUMERATION":this.updateTextField(e,t.newValue);break;case"RICHTEXT":await this.updateRichTextField(e,t.newValue);break;case"INT":case"FLOAT":this.updateNumberField(e,t.newValue);break;case"BOOLEAN":this.updateBooleanField(e,t.newValue);break;case"DATETIME":case"DATE":this.updateDateField(e,t.newValue);break;case"ASSET":await this.updateAssetField(e,t.newValue);break;case"LOCATION":this.updateLocationField(e,t.newValue);break;case"COLOR":this.updateColorField(e,t.newValue);break;case"COMPONENT":await this.updateComponentField(e,t.newValue);break;case"JSON":this.updateJsonField(e,t.newValue);break;default:throw new Error(`Unsupported field type: ${t.fieldType}`)}}updateTextField(e,t){(t||""===t)&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=t:e.textContent=t)}async updateRichTextField(e,t){if(t&&t.children)try{const n=this.richTextToHTML(t);if(this.hasMorphdom()){const t=document.createElement(e.tagName);t.innerHTML=n,window.morphdom(e,t)}else e.innerHTML=n}catch(n){throw console.error("[ContentUpdater] Rich text update failed:",n),n}}updateNumberField(e,t){if(null==t)return;const n=String(t);"INPUT"===e.tagName?e.value=n:e.textContent=n}updateBooleanField(e,t){"INPUT"===e.tagName&&"checkbox"===e.type?e.checked=t:e.textContent=String(t)}updateDateField(e,t){if(!t)return;const n=new Date(t).toLocaleDateString();"INPUT"===e.tagName&&"date"===e.type?e.value=t.split("T")[0]:e.textContent=n}async updateAssetField(e,t){t&&(Array.isArray(t)?t.length>0&&await this.updateSingleAsset(e,t[0]):await this.updateSingleAsset(e,t))}async updateSingleAsset(e,t){if("IMG"===e.tagName){const n=e;n.src=t.url,t.alt&&(n.alt=t.alt),t.width&&(n.width=t.width),t.height&&(n.height=t.height)}else if("VIDEO"===e.tagName){e.src=t.url}else if("AUDIO"===e.tagName){e.src=t.url}else if("A"===e.tagName){const n=e;n.href=t.url,n.textContent||(n.textContent=t.fileName)}else e.innerHTML=`<img src="${t.url}" alt="${t.alt||""}" />`}updateLocationField(e,t){if(!t||"number"!=typeof t.latitude||"number"!=typeof t.longitude)return;const n=`${t.latitude}, ${t.longitude}`;e.textContent=n,e.setAttribute("data-latitude",String(t.latitude)),e.setAttribute("data-longitude",String(t.longitude))}updateColorField(e,t){t&&(e.textContent=t,e.style&&(e.style.backgroundColor=t))}async updateComponentField(e,t){if(t)try{const n=this.renderComponent(t);if(this.hasMorphdom()){const t=document.createElement(e.tagName);t.innerHTML=n,window.morphdom(e,t)}else e.innerHTML=n}catch(n){throw console.error("[ContentUpdater] Component update failed:",n),n}}updateJsonField(e,t){if(null==t)return;const n=JSON.stringify(t,null,2);e.textContent=n}richTextToHTML(e){return e.children?e.children.map(e=>this.renderRichTextNode(e)).join(""):""}renderRichTextNode(e){if(e.text)return this.escapeHtml(e.text);const t=e.children?e.children.map(e=>this.renderRichTextNode(e)).join(""):"";switch(e.type){case"paragraph":return`<p>${t}</p>`;case"heading-one":return`<h1>${t}</h1>`;case"heading-two":return`<h2>${t}</h2>`;case"heading-three":return`<h3>${t}</h3>`;case"heading-four":return`<h4>${t}</h4>`;case"heading-five":return`<h5>${t}</h5>`;case"heading-six":return`<h6>${t}</h6>`;case"block-quote":return`<blockquote>${t}</blockquote>`;case"bulleted-list":return`<ul>${t}</ul>`;case"numbered-list":return`<ol>${t}</ol>`;case"list-item":return`<li>${t}</li>`;case"link":return`<a href="${e.href||""}">${t}</a>`;case"bold":return`<strong>${t}</strong>`;case"italic":return`<em>${t}</em>`;case"underline":return`<u>${t}</u>`;case"code":return`<code>${t}</code>`;default:return t}}renderComponent(e){return`<div data-component="${e.__typename}">${Object.entries(e).filter(([e])=>"__typename"!==e&&"id"!==e).map(([e,t])=>`<div data-field="${e}">${this.escapeHtml(String(t))}</div>`).join("")}</div>`}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}hasMorphdom(){return"function"==typeof window.morphdom}delay(e){return new Promise(t=>setTimeout(t,e))}}class c{constructor(e){this.overlayElement=null,this.editButtonElement=null,this.currentTarget=null,this.isDestroyed=!1,this.handleMouseMove=e=>{var t;if(this.isDestroyed)return;const n=e.target;if(n===this.editButtonElement||(null==(t=this.editButtonElement)?void 0:t.contains(n)))return;const r=n.closest("[data-hygraph-entry-id]");if(r&&r!==this.currentTarget){const e=r.getAttribute("data-hygraph-entry-id"),t=r.getAttribute("data-hygraph-field-api-id"),n=r.getAttribute("data-hygraph-field-locale");if(e){const i={element:r,entryId:e,fieldApiId:t||void 0,locale:n||void 0};this.showOverlay(r,i)}}else!r&&this.currentTarget&&setTimeout(()=>{this.currentTarget&&!this.isMouseOverEditButton(e)&&this.hideOverlay()},50)},this.handleMouseLeave=()=>{this.hideOverlay()},this.handleScroll=()=>{this.currentTarget&&this.updateOverlayPosition(this.currentTarget)},this.handleResize=()=>{this.currentTarget&&this.updateOverlayPosition(this.currentTarget)},this.config=e,this.createOverlayElements(),this.setupEventListeners()}showOverlay(e,t){!this.isDestroyed&&this.config.overlayEnabled&&(this.currentTarget=e,this.updateOverlayPosition(e),this.updateEditButton(t),this.showOverlayElements())}hideOverlay(){this.isDestroyed||(this.currentTarget=null,this.hideOverlayElements())}destroy(){this.isDestroyed=!0,this.removeOverlayElements(),this.removeEventListeners()}createOverlayElements(){this.overlayElement=document.createElement("div"),this.overlayElement.id="hygraph-inspector-overlay",this.overlayElement.style.cssText="\n      position: fixed;\n      pointer-events: none;\n      z-index: 9999;\n      border: 2px solid #3B82F6;\n      background: rgba(59, 130, 246, 0.1);\n      border-radius: 4px;\n      display: none;\n      transition: all 0.2s ease;\n      box-sizing: border-box;\n    ",this.editButtonElement=document.createElement("button"),this.editButtonElement.id="hygraph-inspector-edit-button",this.editButtonElement.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n      Edit\n    ',this.editButtonElement.style.cssText="\n      position: fixed;\n      z-index: 10000;\n      background: #3B82F6;\n      color: white;\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 6px;\n      padding: 8px 12px;\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      display: none;\n      align-items: center;\n      gap: 6px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);\n      transition: all 0.2s ease;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;\n      pointer-events: auto;\n      width: 72px;\n      height: 32px;\n      justify-content: center;\n      box-sizing: border-box;\n      backdrop-filter: blur(8px);\n      -webkit-backdrop-filter: blur(8px);\n    ",this.editButtonElement.addEventListener("mouseenter",()=>{this.editButtonElement.style.background="#2563EB",this.editButtonElement.style.transform="scale(1.05)"}),this.editButtonElement.addEventListener("mouseleave",()=>{this.editButtonElement.style.background="#3B82F6",this.editButtonElement.style.transform="scale(1)"}),document.body.appendChild(this.overlayElement),document.body.appendChild(this.editButtonElement)}setupEventListeners(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseleave",this.handleMouseLeave),document.addEventListener("scroll",this.handleScroll,!0),window.addEventListener("resize",this.handleResize)}removeEventListeners(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseleave",this.handleMouseLeave),document.removeEventListener("scroll",this.handleScroll,!0),window.removeEventListener("resize",this.handleResize)}isMouseOverEditButton(e){if(!this.editButtonElement)return!1;const t=this.editButtonElement.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}updateOverlayPosition(e){if(!this.overlayElement)return;const t=e.getBoundingClientRect();this.overlayElement.style.left=`${t.left}px`,this.overlayElement.style.top=`${t.top}px`,this.overlayElement.style.width=`${t.width}px`,this.overlayElement.style.height=`${t.height}px`}updateEditButton(e){if(!this.editButtonElement||!this.currentTarget)return;const t=this.currentTarget.getBoundingClientRect();let n=t.top+4,r=t.right-72-4;r<t.left+4&&(r=t.left+4),n+32+4>t.bottom&&(n=Math.max(t.top+4,t.bottom-32-4)),r=Math.max(t.left+4,Math.min(r,t.right-72-4)),n=Math.max(t.top+4,Math.min(n,t.bottom-32-4)),this.editButtonElement.style.left=`${r}px`,this.editButtonElement.style.top=`${n}px`,this.editButtonElement.onclick=t=>{t.preventDefault(),t.stopPropagation(),this.handleEditClick(e)};const i=e.fieldApiId||"entry";this.editButtonElement.title=`Edit ${i}`}handleEditClick(e){const t=new CustomEvent("hygraph-edit-click",{detail:e,bubbles:!0});document.dispatchEvent(t),this.config.debug&&console.log("[OverlayManager] Edit button clicked:",e)}showOverlayElements(){this.overlayElement&&(this.overlayElement.style.display="block"),this.editButtonElement&&(this.editButtonElement.style.display="flex")}hideOverlayElements(){this.overlayElement&&(this.overlayElement.style.display="none"),this.editButtonElement&&(this.editButtonElement.style.display="none")}removeOverlayElements(){this.overlayElement&&(this.overlayElement.remove(),this.overlayElement=null),this.editButtonElement&&(this.editButtonElement.remove(),this.editButtonElement=null)}}class u{constructor(e){this.messageBridge=null,this.saveCallbacks=new Set,this.handleEditClick=e=>{const t=e.detail.element;"iframe"===this.mode?this.handleIframeEditClick(t):this.handleStandaloneEditClick(t)},this.config={debug:!1,overlayEnabled:!0,updateDelay:50,retryAttempts:3,autoConnect:!0,allowedOrigins:["https://app.hygraph.com","http://localhost:3000"],...e},this.mode=this.determineMode(),this.fieldRegistry=new a(this.config),this.contentUpdater=new d(this.config),this.overlayManager=new c(this.config),"iframe"===this.mode?this.initializeIframeMode():this.initializeStandaloneMode(),this.setupEditClickHandler(),this.config.debug&&(window.__HYGRAPH_INSPECTOR__=this),this.emitEvent("inspector:ready",{inspector:this})}subscribe(e,t){if("save"===e)return this.saveCallbacks.add(t.callback),()=>this.saveCallbacks.delete(t.callback);throw new Error(`Unknown event type: ${e}`)}getVersion(){return"2.0.0"}getMode(){return this.mode}isConnected(){var e;return(null==(e=this.messageBridge)?void 0:e.isConnectedToStudio())??!1}refresh(){this.fieldRegistry.refresh()}destroy(){var e;this.fieldRegistry.destroy(),null==(e=this.messageBridge)||e.destroy(),this.contentUpdater.destroy(),this.overlayManager.destroy(),this.saveCallbacks.clear(),document.removeEventListener("hygraph-edit-click",this.handleEditClick),window.__HYGRAPH_INSPECTOR__===this&&delete window.__HYGRAPH_INSPECTOR__}determineMode(){if("iframe"===this.config.mode)return"iframe";if("standalone"===this.config.mode)return"standalone";try{return window.self===window.top?"standalone":"iframe"}catch(e){return"iframe"}}initializeIframeMode(){this.config.debug&&console.log("[Inspector] Initializing in iframe mode"),this.messageBridge=new l({debug:this.config.debug,allowedOrigins:this.getAllowedOrigins(),onMessage:this.handleStudioMessage.bind(this),onReady:()=>{this.config.debug&&console.log("[Inspector] MessageBridge ready, sending ready message to Studio"),this.config.autoConnect&&this.sendReadyMessage()}}),this.setupIframeEditHandlers()}initializeStandaloneMode(){this.config.debug&&console.log("[Inspector] Initializing in standalone mode"),this.config.studioUrl||this.isProductionEndpoint()||console.warn("[Inspector] Consider setting studioUrl for development endpoints"),this.setupStandaloneEditHandlers()}getAllowedOrigins(){const e=[...this.config.allowedOrigins||[]];return this.config.studioUrl&&e.push(new URL(this.config.studioUrl).origin),e}isProductionEndpoint(){return this.config.endpoint.includes("api.hygraph.com")||this.config.endpoint.includes(".hygraph.com")}sendReadyMessage(){if(!this.messageBridge)return;const e={type:"ready",sdkVersion:this.getVersion(),timestamp:Date.now()};this.messageBridge.sendReadyMessage(e)}handleStudioMessage(e){switch(e.type){case"init":this.handleInitMessage(e);break;case"field-update":this.handleFieldUpdate(e);break;case"focus-field":this.handleFocusField(e);break;case"bulk-update":this.handleBulkUpdate(e);break;case"content-saved":this.handleContentSaved(e);break;case"disconnect":this.handleDisconnect()}}handleInitMessage(e){this.config.debug&&console.log("[Inspector] Connected to Studio:",e.studioOrigin),this.emitEvent("inspector:connected",{studioOrigin:e.studioOrigin})}async handleFieldUpdate(e){const t=await this.contentUpdater.updateField({entryId:e.entryId,fieldApiId:e.fieldApiId,newValue:e.newValue,locale:e.locale,fieldType:e.fieldType,updateId:e.updateId});if(this.messageBridge){const n=t.success?{type:"update-complete",updateId:e.updateId,timestamp:Date.now()}:{type:"update-failed",updateId:e.updateId,error:t.error||"Update failed",timestamp:Date.now()};this.messageBridge.sendMessage(n)}t.success?this.emitEvent("inspector:field-updated",{entryId:e.entryId,fieldApiId:e.fieldApiId,newValue:e.newValue}):this.emitEvent("inspector:update-failed",{entryId:e.entryId,fieldApiId:e.fieldApiId,error:t.error||"Update failed"})}handleFocusField(e){const t=this.fieldRegistry.getElementsForField(e.fieldApiId,e.locale);if(t.length>0){const e=t[0].element;e.scrollIntoView({behavior:"smooth",block:"center"}),(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&e.focus()}}async handleBulkUpdate(e){const t=await Promise.all(e.changes.map(e=>this.contentUpdater.updateField(e))),n=t.every(e=>e.success),r=t.filter(e=>!e.success).map(e=>e.error);if(this.messageBridge){const e=n?{type:"update-complete",timestamp:Date.now()}:{type:"update-failed",error:`Bulk update failed: ${r.join(", ")}`,timestamp:Date.now()};this.messageBridge.sendMessage(e)}}async handleContentSaved(e){this.config.debug&&console.log("[Inspector] Content saved, triggering framework refresh"),this.emitEvent("inspector:content-saved",{entryId:e.entryId,timestamp:e.timestamp});for(const n of this.saveCallbacks)try{await n(e.entryId)}catch(t){console.error("[Inspector] Save callback failed:",t)}}handleDisconnect(){this.config.debug&&console.log("[Inspector] Disconnected from Studio"),this.emitEvent("inspector:disconnected",{})}setupEditClickHandler(){document.addEventListener("hygraph-edit-click",this.handleEditClick)}setupIframeEditHandlers(){}setupStandaloneEditHandlers(){}handleIframeEditClick(e){var t;const n=e.getAttribute("data-hygraph-entry-id"),r=e.getAttribute("data-hygraph-field-api-id")||void 0,i=e.getAttribute("data-hygraph-field-locale")||void 0;if(n){if(this.messageBridge){const s={type:"field-click",entryId:n,fieldApiId:r,locale:i,timestamp:Date.now()};this.messageBridge.sendMessage(s)||!1===(null==(t=this.config.standalone)?void 0:t.fallbackToNewTab)||(this.config.debug&&console.log("[Inspector] Studio not connected, falling back to new tab"),this.handleStandaloneEditClick(e))}this.emitEvent("inspector:field-click",{entryId:n,fieldApiId:r,locale:i,mode:this.mode})}}handleStandaloneEditClick(e){const t=e.getAttribute("data-hygraph-entry-id"),n=e.getAttribute("data-hygraph-field-api-id")||void 0,r=e.getAttribute("data-hygraph-field-locale")||void 0;if(!t)return;if(!this.config.endpoint)return void console.error("[Inspector] Cannot open Studio - no endpoint configured");const i=this.buildStudioUrl(t,n,r);window.open(i,"_blank","noopener,noreferrer"),this.config.debug&&console.log("[Inspector] Opened Studio in new tab:",i),this.emitEvent("inspector:field-click",{entryId:t,fieldApiId:n,locale:r,mode:this.mode})}buildStudioUrl(e,t,n){const r=this.config.studioUrl||"https://app.hygraph.com",i=new URLSearchParams({endpoint:this.config.endpoint,entryId:e});return t&&i.set("fieldApiId",t),n&&i.set("locale",n),`${r}/entry?${i.toString()}`}emitEvent(e,t){const n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}}const p=e.createContext({inspector:null,isReady:!1,isConnected:!1});function h(){const t=e.useContext(p);if(!t)throw new Error("useInspector must be used within a HygraphInspector component");return t}function f(t){const{inspector:n}=h();e.useEffect(()=>{if(!n)return;return n.subscribe("save",{callback:t})},[n,t])}function g(t,n){e.useEffect(()=>{const e=e=>{n(e)};return document.addEventListener(t,e),()=>document.removeEventListener(t,e)},[t,n])}function y(){const{inspector:t}=h(),n=e.useRef(null);e.useEffect(()=>{if(!t)return;const e=t.frameworkIntegration,r=null==e?void 0:e.getFramework();n.current=(null==r?void 0:r.type)||null},[t]);return{refresh:e.useCallback(async()=>{if(!t)return;const e=t.frameworkIntegration;e?await e.refresh():window.location.reload()},[t]),framework:n.current}}exports.HygraphInspector=function({children:t,onReady:n,onConnected:r,onDisconnected:i,onSave:s,onError:a,...l}){const d=e.useRef(null),[c,h]=e.useState({inspector:null,isReady:!1,isConnected:!1});return e.useEffect(()=>{try{const e=new u(l);d.current=e;const t=e=>{h(t=>({...t,inspector:e.detail.inspector,isReady:!0})),null==n||n(e.detail.inspector)},o=e=>{h(e=>({...e,isConnected:!0})),null==r||r(e.detail.studioOrigin)},c=()=>{h(e=>({...e,isConnected:!1})),null==i||i()},p=e=>{null==a||a(e.detail.error)};let f;return document.addEventListener("inspector:ready",t),document.addEventListener("inspector:connected",o),document.addEventListener("inspector:disconnected",c),document.addEventListener("inspector:error",p),s&&(f=e.subscribe("save",{callback:s})),()=>{document.removeEventListener("inspector:ready",t),document.removeEventListener("inspector:connected",o),document.removeEventListener("inspector:disconnected",c),document.removeEventListener("inspector:error",p),null==f||f(),e.destroy()}}catch(e){return console.error("[HygraphInspector] Failed to initialize:",e),null==a||a(e instanceof Error?e:new Error(String(e))),()=>{}}},[l.endpoint,l.debug,l.studioUrl,l.mode,n,r,i,s,a]),o.jsx(p.Provider,{value:c,children:t})},exports.Inspector=u,exports.useInspector=h,exports.useInspectorActions=function(){const{inspector:t}=h();return{refresh:e.useCallback(()=>{null==t||t.refresh()},[t]),destroy:e.useCallback(()=>{null==t||t.destroy()},[t]),getVersion:e.useCallback(()=>(null==t?void 0:t.getVersion())||null,[t]),getMode:e.useCallback(()=>(null==t?void 0:t.getMode())||null,[t])}},exports.useInspectorConnection=function(){const{inspector:e,isReady:t,isConnected:n}=h();return{isConnected:n,isReady:t,mode:(null==e?void 0:e.getMode())||null}},exports.useInspectorDebug=function(){const{inspector:t}=h(),n=e.useCallback(()=>{if(!t)return null;const e=t.fieldRegistry;return(null==e?void 0:e.getStats())||null},[t]),r=e.useCallback(()=>{if(!t)return[];const e=t.fieldRegistry;return(null==e?void 0:e.getRegistryKeys())||[]},[t]),i=e.useCallback(()=>{if(!t)return null;const e=t.frameworkIntegration;return(null==e?void 0:e.getFramework())||null},[t]);return{inspector:t,stats:n(),registryKeys:r(),framework:i()}},exports.useInspectorEvent=g,exports.useInspectorFieldUpdates=function(e,t){g("inspector:field-updated",t=>{null==e||e(t.detail)}),g("inspector:update-failed",e=>{null==t||t(e.detail)})},exports.useInspectorNextjs=function(){const{refresh:t}=y(),n=e.useCallback(()=>{var e,t;if("undefined"==typeof window)return null;return(null==(e=window.next)?void 0:e.router)||(null==(t=window.__NEXT_DATA__)?void 0:t.router)||null},[]);f(e.useCallback(()=>{const e=n();e&&"function"==typeof e.replace?e.replace(e.asPath||window.location.pathname):t()},[t,n]))},exports.useInspectorRefresh=y,exports.useInspectorRemix=function(){const{refresh:t}=y(),n=e.useCallback(()=>{var e;return"undefined"==typeof window?null:window.__remixRevalidator||(null==(e=window.__remixRouterContext)?void 0:e.revalidator)||null},[]);f(e.useCallback(()=>{const e=n();e&&"function"==typeof e.revalidate?e.revalidate():t()},[t,n]))},exports.useInspectorSave=f;
//# sourceMappingURL=index.cjs.js.map

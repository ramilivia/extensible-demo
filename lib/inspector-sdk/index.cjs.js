"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});class e{constructor(e){this.registry={},this.observer=null,this.isDestroyed=!1,this.config=e,this.initializeObserver(),this.scanExistingElements()}getElementsForField(e,t){const i=[];for(const n of Object.values(this.registry))for(const s of n)s.fieldApiId===e&&s.locale===t&&i.push(s);return i}getElementsForEntry(e){const t=[];for(const i of Object.values(this.registry))for(const n of i)n.entryId===e&&t.push(n);return t}getElement(e,t,i){const n=this.createRegistryKey(e,t,i),s=this.registry[n];return(null==s?void 0:s[0])||null}refresh(){this.isDestroyed||this.scanExistingElements()}destroy(){var e;this.isDestroyed=!0,null==(e=this.observer)||e.disconnect(),this.registry={}}initializeObserver(){this.observer=new MutationObserver(e=>{var t;if(!this.isDestroyed)for(const i of e){if("childList"===i.type)for(const e of i.addedNodes)e.nodeType===Node.ELEMENT_NODE&&this.scanElement(e);"attributes"===i.type&&(null==(t=i.attributeName)?void 0:t.startsWith("data-hygraph-"))&&this.updateElementRegistration(i.target)}}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-hygraph-entry-id","data-hygraph-field-api-id","data-hygraph-field-locale"]})}scanExistingElements(){document.querySelectorAll("[data-hygraph-entry-id]").forEach(e=>this.scanElement(e))}scanElement(e){this.hasHygraphAttributes(e)&&this.registerElement(e);e.querySelectorAll("[data-hygraph-entry-id]").forEach(e=>this.registerElement(e))}hasHygraphAttributes(e){return e.hasAttribute("data-hygraph-entry-id")}registerElement(e){const t=e.getAttribute("data-hygraph-entry-id");if(!t)return;const i=e.getAttribute("data-hygraph-field-api-id")||void 0,n=e.getAttribute("data-hygraph-field-locale")||void 0,s={element:e,entryId:t,fieldApiId:i,locale:n,lastUpdated:Date.now()},r=this.createRegistryKey(t,i,n);this.registry[r]||(this.registry[r]=[]);const o=this.registry[r].findIndex(t=>t.element===e);o>=0?this.registry[r][o]=s:this.registry[r].push(s),this.config.debug&&console.log("[FieldRegistry] Registered element:",{entryId:t,fieldApiId:i,locale:n,element:e.tagName})}updateElementRegistration(e){this.unregisterElement(e),this.hasHygraphAttributes(e)&&this.registerElement(e)}unregisterElement(e){for(const[t,i]of Object.entries(this.registry)){const n=i.filter(t=>t.element!==e);0===n.length?delete this.registry[t]:this.registry[t]=n}}createRegistryKey(e,t,i){const n=[e];return t&&n.push(t),i&&n.push(i),n.join(":")}getStats(){const e=new Set,t=new Set;let i=0;for(const n of Object.values(this.registry)){i+=n.length;for(const i of n)e.add(i.entryId),i.fieldApiId&&t.add(`${i.entryId}:${i.fieldApiId}`)}return{totalElements:i,entriesCount:e.size,fieldsCount:t.size}}getRegistryKeys(){return Object.keys(this.registry)}}class t{constructor(e){this.isConnected=!1,this.studioOrigin=null,this.messageQueue=[],this.isDestroyed=!1,this.handleMessage=e=>{if(this.isDestroyed)return;if(!this.isOriginAllowed(e.origin))return void(this.config.debug&&console.log("[MessageBridge] Ignored message from disallowed origin:",e.origin));const t=e.data;this.isValidStudioMessage(t)?(this.config.debug&&console.log("[MessageBridge] Received message:",t),"init"===t.type&&this.handleConnection(e.origin),this.config.onMessage(t)):this.config.debug&&console.log("[MessageBridge] Ignored invalid message:",t)},this.config=e,this.setupMessageListener()}sendMessage(e){if(this.isDestroyed)return!1;if(!this.isConnected||!this.studioOrigin)return this.messageQueue.push(e),!1;try{return window.parent.postMessage(e,this.studioOrigin),this.config.debug&&console.log("[MessageBridge] Sent message:",e),!0}catch(t){return console.error("[MessageBridge] Failed to send message:",t),!1}}sendReadyMessage(e){if(this.isDestroyed)return!1;let t=!1;for(const n of this.config.allowedOrigins)try{window.parent.postMessage(e,n),this.config.debug&&console.log("[MessageBridge] Sent ready message to origin:",n,"message:",e),t=!0}catch(i){this.config.debug&&console.log("[MessageBridge] Failed to send ready message to origin:",n,"error:",i)}return t}isConnectedToStudio(){return this.isConnected}getStudioOrigin(){return this.studioOrigin}destroy(){this.isDestroyed=!0,this.isConnected=!1,this.studioOrigin=null,this.messageQueue=[],window.removeEventListener("message",this.handleMessage)}setupMessageListener(){this.config.debug&&console.log("[MessageBridge] Setting up message listener, allowed origins:",this.config.allowedOrigins),window.addEventListener("message",this.handleMessage),this.config.onReady&&setTimeout(()=>{this.config.onReady()},0)}isOriginAllowed(e){return this.config.allowedOrigins.includes(e)||this.config.allowedOrigins.some(t=>{if(t.includes("*")){const i=t.replace(/\*/g,".*");return new RegExp(`^${i}$`).test(e)}return!1})}isValidStudioMessage(e){if(!e||"object"!=typeof e)return!1;if("string"!=typeof e.type)return!1;if("number"!=typeof e.timestamp)return!1;switch(e.type){case"init":return"string"==typeof e.studioOrigin;case"field-update":return"string"==typeof e.entryId&&"string"==typeof e.fieldApiId&&"string"==typeof e.fieldType&&void 0!==e.newValue;case"focus-field":return"string"==typeof e.fieldApiId;case"bulk-update":return Array.isArray(e.changes);case"content-saved":return"string"==typeof e.entryId;case"disconnect":return!0;default:return!1}}handleConnection(e){this.isConnected||(this.isConnected=!0,this.studioOrigin=e,this.config.debug&&console.log("[MessageBridge] Connected to Studio:",e),this.flushMessageQueue())}flushMessageQueue(){const e=[...this.messageQueue];this.messageQueue=[];for(const t of e)this.sendMessage(t);this.config.debug&&e.length>0&&console.log(`[MessageBridge] Sent ${e.length} queued messages`)}}class i{constructor(e){this.updateQueue=new Map,this.isDestroyed=!1,this.config=e}async updateField(e){if(this.isDestroyed)return{success:!1,error:"ContentUpdater is destroyed"};try{const i=`${e.entryId}:${e.fieldApiId}:${e.locale||""}`;this.updateQueue.set(i,e),await this.delay(this.config.updateDelay||50);if(this.updateQueue.get(i)!==e)return{success:!0};this.updateQueue.delete(i);const n=this.findElements(e.entryId,e.fieldApiId,e.locale);if(0===n.length)return{success:!1,error:"No matching elements found"};let s=!1,r="";for(const o of n)try{await this.updateElement(o,e)}catch(t){s=!0,r=t instanceof Error?t.message:String(t),console.error("[ContentUpdater] Failed to update element:",t)}return s?{success:!1,error:r}:(this.config.debug&&console.log("[ContentUpdater] Updated field:",{entryId:e.entryId,fieldApiId:e.fieldApiId,locale:e.locale,elementsCount:n.length}),{success:!0,element:n[0]})}catch(t){const e=t instanceof Error?t.message:String(t);return console.error("[ContentUpdater] Update failed:",t),{success:!1,error:e}}}destroy(){this.isDestroyed=!0,this.updateQueue.clear()}findElements(e,t,i){const n=[];let s=`[data-hygraph-entry-id="${e}"]`;t&&(s+=`[data-hygraph-field-api-id="${t}"]`),i&&(s+=`[data-hygraph-field-locale="${i}"]`);const r=document.querySelectorAll(s);return n.push(...Array.from(r)),n}async updateElement(e,t){switch(t.fieldType){case"STRING":case"ID":case"ENUMERATION":this.updateTextField(e,t.newValue);break;case"RICHTEXT":await this.updateRichTextField(e,t.newValue);break;case"INT":case"FLOAT":this.updateNumberField(e,t.newValue);break;case"BOOLEAN":this.updateBooleanField(e,t.newValue);break;case"DATETIME":case"DATE":this.updateDateField(e,t.newValue);break;case"ASSET":await this.updateAssetField(e,t.newValue);break;case"LOCATION":this.updateLocationField(e,t.newValue);break;case"COLOR":this.updateColorField(e,t.newValue);break;case"COMPONENT":await this.updateComponentField(e,t.newValue);break;case"JSON":this.updateJsonField(e,t.newValue);break;default:throw new Error(`Unsupported field type: ${t.fieldType}`)}}updateTextField(e,t){(t||""===t)&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=t:e.textContent=t)}async updateRichTextField(e,t){if(t&&t.children)try{const i=this.richTextToHTML(t);if(this.hasMorphdom()){const t=document.createElement(e.tagName);t.innerHTML=i,window.morphdom(e,t)}else e.innerHTML=i}catch(i){throw console.error("[ContentUpdater] Rich text update failed:",i),i}}updateNumberField(e,t){if(null==t)return;const i=String(t);"INPUT"===e.tagName?e.value=i:e.textContent=i}updateBooleanField(e,t){"INPUT"===e.tagName&&"checkbox"===e.type?e.checked=t:e.textContent=String(t)}updateDateField(e,t){if(!t)return;const i=new Date(t).toLocaleDateString();"INPUT"===e.tagName&&"date"===e.type?e.value=t.split("T")[0]:e.textContent=i}async updateAssetField(e,t){t&&(Array.isArray(t)?t.length>0&&await this.updateSingleAsset(e,t[0]):await this.updateSingleAsset(e,t))}async updateSingleAsset(e,t){if("IMG"===e.tagName){const i=e;i.src=t.url,t.alt&&(i.alt=t.alt),t.width&&(i.width=t.width),t.height&&(i.height=t.height)}else if("VIDEO"===e.tagName){e.src=t.url}else if("AUDIO"===e.tagName){e.src=t.url}else if("A"===e.tagName){const i=e;i.href=t.url,i.textContent||(i.textContent=t.fileName)}else e.innerHTML=`<img src="${t.url}" alt="${t.alt||""}" />`}updateLocationField(e,t){if(!t||"number"!=typeof t.latitude||"number"!=typeof t.longitude)return;const i=`${t.latitude}, ${t.longitude}`;e.textContent=i,e.setAttribute("data-latitude",String(t.latitude)),e.setAttribute("data-longitude",String(t.longitude))}updateColorField(e,t){t&&(e.textContent=t,e.style&&(e.style.backgroundColor=t))}async updateComponentField(e,t){if(t)try{const i=this.renderComponent(t);if(this.hasMorphdom()){const t=document.createElement(e.tagName);t.innerHTML=i,window.morphdom(e,t)}else e.innerHTML=i}catch(i){throw console.error("[ContentUpdater] Component update failed:",i),i}}updateJsonField(e,t){if(null==t)return;const i=JSON.stringify(t,null,2);e.textContent=i}richTextToHTML(e){return e.children?e.children.map(e=>this.renderRichTextNode(e)).join(""):""}renderRichTextNode(e){if(e.text)return this.escapeHtml(e.text);const t=e.children?e.children.map(e=>this.renderRichTextNode(e)).join(""):"";switch(e.type){case"paragraph":return`<p>${t}</p>`;case"heading-one":return`<h1>${t}</h1>`;case"heading-two":return`<h2>${t}</h2>`;case"heading-three":return`<h3>${t}</h3>`;case"heading-four":return`<h4>${t}</h4>`;case"heading-five":return`<h5>${t}</h5>`;case"heading-six":return`<h6>${t}</h6>`;case"block-quote":return`<blockquote>${t}</blockquote>`;case"bulleted-list":return`<ul>${t}</ul>`;case"numbered-list":return`<ol>${t}</ol>`;case"list-item":return`<li>${t}</li>`;case"link":return`<a href="${e.href||""}">${t}</a>`;case"bold":return`<strong>${t}</strong>`;case"italic":return`<em>${t}</em>`;case"underline":return`<u>${t}</u>`;case"code":return`<code>${t}</code>`;default:return t}}renderComponent(e){return`<div data-component="${e.__typename}">${Object.entries(e).filter(([e])=>"__typename"!==e&&"id"!==e).map(([e,t])=>`<div data-field="${e}">${this.escapeHtml(String(t))}</div>`).join("")}</div>`}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}hasMorphdom(){return"function"==typeof window.morphdom}delay(e){return new Promise(t=>setTimeout(t,e))}}class n{constructor(e){this.overlayElement=null,this.editButtonElement=null,this.currentTarget=null,this.isDestroyed=!1,this.handleMouseMove=e=>{var t;if(this.isDestroyed)return;const i=e.target;if(i===this.editButtonElement||(null==(t=this.editButtonElement)?void 0:t.contains(i)))return;const n=i.closest("[data-hygraph-entry-id]");if(n&&n!==this.currentTarget){const e=n.getAttribute("data-hygraph-entry-id"),t=n.getAttribute("data-hygraph-field-api-id"),i=n.getAttribute("data-hygraph-field-locale");if(e){const s={element:n,entryId:e,fieldApiId:t||void 0,locale:i||void 0};this.showOverlay(n,s)}}else!n&&this.currentTarget&&setTimeout(()=>{this.currentTarget&&!this.isMouseOverEditButton(e)&&this.hideOverlay()},50)},this.handleMouseLeave=()=>{this.hideOverlay()},this.handleScroll=()=>{this.currentTarget&&this.updateOverlayPosition(this.currentTarget)},this.handleResize=()=>{this.currentTarget&&this.updateOverlayPosition(this.currentTarget)},this.config=e,this.createOverlayElements(),this.setupEventListeners()}showOverlay(e,t){!this.isDestroyed&&this.config.overlayEnabled&&(this.currentTarget=e,this.updateOverlayPosition(e),this.updateEditButton(t),this.showOverlayElements())}hideOverlay(){this.isDestroyed||(this.currentTarget=null,this.hideOverlayElements())}destroy(){this.isDestroyed=!0,this.removeOverlayElements(),this.removeEventListeners()}createOverlayElements(){this.overlayElement=document.createElement("div"),this.overlayElement.id="hygraph-inspector-overlay",this.overlayElement.style.cssText="\n      position: fixed;\n      pointer-events: none;\n      z-index: 9999;\n      border: 2px solid #3B82F6;\n      background: rgba(59, 130, 246, 0.1);\n      border-radius: 4px;\n      display: none;\n      transition: all 0.2s ease;\n      box-sizing: border-box;\n    ",this.editButtonElement=document.createElement("button"),this.editButtonElement.id="hygraph-inspector-edit-button",this.editButtonElement.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n      Edit\n    ',this.editButtonElement.style.cssText="\n      position: fixed;\n      z-index: 10000;\n      background: #3B82F6;\n      color: white;\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 6px;\n      padding: 8px 12px;\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      display: none;\n      align-items: center;\n      gap: 6px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);\n      transition: all 0.2s ease;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;\n      pointer-events: auto;\n      width: 72px;\n      height: 32px;\n      justify-content: center;\n      box-sizing: border-box;\n      backdrop-filter: blur(8px);\n      -webkit-backdrop-filter: blur(8px);\n    ",this.editButtonElement.addEventListener("mouseenter",()=>{this.editButtonElement.style.background="#2563EB",this.editButtonElement.style.transform="scale(1.05)"}),this.editButtonElement.addEventListener("mouseleave",()=>{this.editButtonElement.style.background="#3B82F6",this.editButtonElement.style.transform="scale(1)"}),document.body.appendChild(this.overlayElement),document.body.appendChild(this.editButtonElement)}setupEventListeners(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseleave",this.handleMouseLeave),document.addEventListener("scroll",this.handleScroll,!0),window.addEventListener("resize",this.handleResize)}removeEventListeners(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseleave",this.handleMouseLeave),document.removeEventListener("scroll",this.handleScroll,!0),window.removeEventListener("resize",this.handleResize)}isMouseOverEditButton(e){if(!this.editButtonElement)return!1;const t=this.editButtonElement.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}updateOverlayPosition(e){if(!this.overlayElement)return;const t=e.getBoundingClientRect();this.overlayElement.style.left=`${t.left}px`,this.overlayElement.style.top=`${t.top}px`,this.overlayElement.style.width=`${t.width}px`,this.overlayElement.style.height=`${t.height}px`}updateEditButton(e){if(!this.editButtonElement||!this.currentTarget)return;const t=this.currentTarget.getBoundingClientRect();let i=t.top+4,n=t.right-72-4;n<t.left+4&&(n=t.left+4),i+32+4>t.bottom&&(i=Math.max(t.top+4,t.bottom-32-4)),n=Math.max(t.left+4,Math.min(n,t.right-72-4)),i=Math.max(t.top+4,Math.min(i,t.bottom-32-4)),this.editButtonElement.style.left=`${n}px`,this.editButtonElement.style.top=`${i}px`,this.editButtonElement.onclick=t=>{t.preventDefault(),t.stopPropagation(),this.handleEditClick(e)};const s=e.fieldApiId||"entry";this.editButtonElement.title=`Edit ${s}`}handleEditClick(e){const t=new CustomEvent("hygraph-edit-click",{detail:e,bubbles:!0});document.dispatchEvent(t),this.config.debug&&console.log("[OverlayManager] Edit button clicked:",e)}showOverlayElements(){this.overlayElement&&(this.overlayElement.style.display="block"),this.editButtonElement&&(this.editButtonElement.style.display="flex")}hideOverlayElements(){this.overlayElement&&(this.overlayElement.style.display="none"),this.editButtonElement&&(this.editButtonElement.style.display="none")}removeOverlayElements(){this.overlayElement&&(this.overlayElement.remove(),this.overlayElement=null),this.editButtonElement&&(this.editButtonElement.remove(),this.editButtonElement=null)}}class s{constructor(t){this.messageBridge=null,this.saveCallbacks=new Set,this.handleEditClick=e=>{const t=e.detail.element;"iframe"===this.mode?this.handleIframeEditClick(t):this.handleStandaloneEditClick(t)},this.config={debug:!1,overlayEnabled:!0,updateDelay:50,retryAttempts:3,autoConnect:!0,allowedOrigins:["https://app.hygraph.com","http://localhost:3000"],...t},this.mode=this.determineMode(),this.fieldRegistry=new e(this.config),this.contentUpdater=new i(this.config),this.overlayManager=new n(this.config),"iframe"===this.mode?this.initializeIframeMode():this.initializeStandaloneMode(),this.setupEditClickHandler(),this.config.debug&&(window.__HYGRAPH_INSPECTOR__=this),this.emitEvent("inspector:ready",{inspector:this})}subscribe(e,t){if("save"===e)return this.saveCallbacks.add(t.callback),()=>this.saveCallbacks.delete(t.callback);throw new Error(`Unknown event type: ${e}`)}getVersion(){return"2.0.0"}getMode(){return this.mode}isConnected(){var e;return(null==(e=this.messageBridge)?void 0:e.isConnectedToStudio())??!1}refresh(){this.fieldRegistry.refresh()}destroy(){var e;this.fieldRegistry.destroy(),null==(e=this.messageBridge)||e.destroy(),this.contentUpdater.destroy(),this.overlayManager.destroy(),this.saveCallbacks.clear(),document.removeEventListener("hygraph-edit-click",this.handleEditClick),window.__HYGRAPH_INSPECTOR__===this&&delete window.__HYGRAPH_INSPECTOR__}determineMode(){if("iframe"===this.config.mode)return"iframe";if("standalone"===this.config.mode)return"standalone";try{return window.self===window.top?"standalone":"iframe"}catch(e){return"iframe"}}initializeIframeMode(){this.config.debug&&console.log("[Inspector] Initializing in iframe mode"),this.messageBridge=new t({debug:this.config.debug,allowedOrigins:this.getAllowedOrigins(),onMessage:this.handleStudioMessage.bind(this),onReady:()=>{this.config.debug&&console.log("[Inspector] MessageBridge ready, sending ready message to Studio"),this.config.autoConnect&&this.sendReadyMessage()}}),this.setupIframeEditHandlers()}initializeStandaloneMode(){this.config.debug&&console.log("[Inspector] Initializing in standalone mode"),this.config.studioUrl||this.isProductionEndpoint()||console.warn("[Inspector] Consider setting studioUrl for development endpoints"),this.setupStandaloneEditHandlers()}getAllowedOrigins(){const e=[...this.config.allowedOrigins||[]];return this.config.studioUrl&&e.push(new URL(this.config.studioUrl).origin),e}isProductionEndpoint(){return this.config.endpoint.includes("api.hygraph.com")||this.config.endpoint.includes(".hygraph.com")}sendReadyMessage(){if(!this.messageBridge)return;const e={type:"ready",sdkVersion:this.getVersion(),timestamp:Date.now()};this.messageBridge.sendReadyMessage(e)}handleStudioMessage(e){switch(e.type){case"init":this.handleInitMessage(e);break;case"field-update":this.handleFieldUpdate(e);break;case"focus-field":this.handleFocusField(e);break;case"bulk-update":this.handleBulkUpdate(e);break;case"content-saved":this.handleContentSaved(e);break;case"disconnect":this.handleDisconnect()}}handleInitMessage(e){this.config.debug&&console.log("[Inspector] Connected to Studio:",e.studioOrigin),this.emitEvent("inspector:connected",{studioOrigin:e.studioOrigin})}async handleFieldUpdate(e){const t=await this.contentUpdater.updateField({entryId:e.entryId,fieldApiId:e.fieldApiId,newValue:e.newValue,locale:e.locale,fieldType:e.fieldType,updateId:e.updateId});if(this.messageBridge){const i=t.success?{type:"update-complete",updateId:e.updateId,timestamp:Date.now()}:{type:"update-failed",updateId:e.updateId,error:t.error||"Update failed",timestamp:Date.now()};this.messageBridge.sendMessage(i)}t.success?this.emitEvent("inspector:field-updated",{entryId:e.entryId,fieldApiId:e.fieldApiId,newValue:e.newValue}):this.emitEvent("inspector:update-failed",{entryId:e.entryId,fieldApiId:e.fieldApiId,error:t.error||"Update failed"})}handleFocusField(e){const t=this.fieldRegistry.getElementsForField(e.fieldApiId,e.locale);if(t.length>0){const e=t[0].element;e.scrollIntoView({behavior:"smooth",block:"center"}),(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&e.focus()}}async handleBulkUpdate(e){const t=await Promise.all(e.changes.map(e=>this.contentUpdater.updateField(e))),i=t.every(e=>e.success),n=t.filter(e=>!e.success).map(e=>e.error);if(this.messageBridge){const e=i?{type:"update-complete",timestamp:Date.now()}:{type:"update-failed",error:`Bulk update failed: ${n.join(", ")}`,timestamp:Date.now()};this.messageBridge.sendMessage(e)}}async handleContentSaved(e){this.config.debug&&console.log("[Inspector] Content saved, triggering framework refresh"),this.emitEvent("inspector:content-saved",{entryId:e.entryId,timestamp:e.timestamp});for(const i of this.saveCallbacks)try{await i(e.entryId)}catch(t){console.error("[Inspector] Save callback failed:",t)}}handleDisconnect(){this.config.debug&&console.log("[Inspector] Disconnected from Studio"),this.emitEvent("inspector:disconnected",{})}setupEditClickHandler(){document.addEventListener("hygraph-edit-click",this.handleEditClick)}setupIframeEditHandlers(){}setupStandaloneEditHandlers(){}handleIframeEditClick(e){var t;const i=e.getAttribute("data-hygraph-entry-id"),n=e.getAttribute("data-hygraph-field-api-id")||void 0,s=e.getAttribute("data-hygraph-field-locale")||void 0;if(i){if(this.messageBridge){const r={type:"field-click",entryId:i,fieldApiId:n,locale:s,timestamp:Date.now()};this.messageBridge.sendMessage(r)||!1===(null==(t=this.config.standalone)?void 0:t.fallbackToNewTab)||(this.config.debug&&console.log("[Inspector] Studio not connected, falling back to new tab"),this.handleStandaloneEditClick(e))}this.emitEvent("inspector:field-click",{entryId:i,fieldApiId:n,locale:s,mode:this.mode})}}handleStandaloneEditClick(e){const t=e.getAttribute("data-hygraph-entry-id"),i=e.getAttribute("data-hygraph-field-api-id")||void 0,n=e.getAttribute("data-hygraph-field-locale")||void 0;if(!t)return;if(!this.config.endpoint)return void console.error("[Inspector] Cannot open Studio - no endpoint configured");const s=this.buildStudioUrl(t,i,n);window.open(s,"_blank","noopener,noreferrer"),this.config.debug&&console.log("[Inspector] Opened Studio in new tab:",s),this.emitEvent("inspector:field-click",{entryId:t,fieldApiId:i,locale:n,mode:this.mode})}buildStudioUrl(e,t,i){const n=this.config.studioUrl||"https://app.hygraph.com",s=new URLSearchParams({endpoint:this.config.endpoint,entryId:e});return t&&s.set("fieldApiId",t),i&&s.set("locale",i),`${n}/entry?${s.toString()}`}emitEvent(e,t){const i=new CustomEvent(e,{detail:t});document.dispatchEvent(i)}}exports.ContentUpdater=i,exports.FieldRegistry=e,exports.FrameworkIntegration=class{constructor(){this.detectedFramework=null,this.detectFramework()}getFramework(){return this.detectedFramework}getRefreshFunction(){if(!this.detectedFramework)return null;switch(this.detectedFramework.type){case"nextjs":return this.getNextjsRefresh();case"remix":return this.getRemixRefresh();case"gatsby":return this.getGatsbyRefresh();case"nuxt":return this.getNuxtRefresh();case"sveltekit":return this.getSveltekitRefresh();default:return this.getVanillaRefresh()}}async refresh(){const e=this.getRefreshFunction();e?await e():window.location.reload()}detectFramework(){this.hasNextjs()?this.detectedFramework={type:"nextjs",router:this.getNextjsRouter()}:this.hasRemix()?this.detectedFramework={type:"remix",revalidator:this.getRemixRevalidator()}:this.hasGatsby()?this.detectedFramework={type:"gatsby"}:this.hasNuxt()?this.detectedFramework={type:"nuxt"}:this.hasSveltekit()?this.detectedFramework={type:"sveltekit"}:this.detectedFramework={type:"vanilla"}}hasNextjs(){return"undefined"!=typeof window&&(window.__NEXT_DATA__||window.next||null!==document.querySelector('script[src*="/_next/"]'))}hasRemix(){return"undefined"!=typeof window&&(window.__remixContext||window.__remixRouterContext||null!==document.querySelector('script[src*="/build/"]'))}hasGatsby(){return"undefined"!=typeof window&&(window.___gatsby||window.__GATSBY||null!==document.querySelector("[data-gatsby-browser-entry]"))}hasNuxt(){return"undefined"!=typeof window&&(window.__NUXT__||window.$nuxt||null!==document.querySelector("#__nuxt"))}hasSveltekit(){return"undefined"!=typeof window&&(window.__SVELTEKIT__||null!==document.querySelector("[data-sveltekit-preload-data]"))}getNextjsRouter(){var e,t;return"undefined"==typeof window?null:(null==(e=window.next)?void 0:e.router)||(null==(t=window.__NEXT_DATA__)?void 0:t.router)||null}getRemixRevalidator(){var e;return"undefined"==typeof window?null:window.__remixRevalidator||(null==(e=window.__remixRouterContext)?void 0:e.revalidator)||null}getNextjsRefresh(){var e;const t=this.getNextjsRouter();return t&&"function"==typeof t.replace?()=>{t.replace(t.asPath||window.location.pathname)}:"function"==typeof(null==(e=window.location)?void 0:e.reload)?()=>window.location.reload():null}getRemixRefresh(){const e=this.getRemixRevalidator();return e&&"function"==typeof e.revalidate?()=>e.revalidate():"function"==typeof window.__remixRevalidate?()=>window.__remixRevalidate():null}getGatsbyRefresh(){return()=>window.location.reload()}getNuxtRefresh(){const e=window.$nuxt;return e&&"function"==typeof e.refresh?()=>e.refresh():"function"==typeof window.refreshCookie?()=>window.refreshCookie():()=>window.location.reload()}getSveltekitRefresh(){return"function"==typeof window.invalidateAll?()=>window.invalidateAll():()=>window.location.reload()}getVanillaRefresh(){return()=>window.location.reload()}getSetupInstructions(){if(!this.detectedFramework)return"";switch(this.detectedFramework.type){case"nextjs":return"\n// Next.js setup:\nimport { HygraphInspector } from '@hygraph/inspector-sdk/react';\nimport { useRouter } from 'next/router';\n\nfunction App() {\n  const router = useRouter();\n\n  return (\n    <HygraphInspector\n      endpoint=\"your-endpoint\"\n      onSave={() => router.replace(router.asPath)}\n    >\n      {/* Your content */}\n    </HygraphInspector>\n  );\n}";case"remix":return"\n// Remix setup:\nimport { HygraphInspector } from '@hygraph/inspector-sdk/react';\nimport { useRevalidator } from '@remix-run/react';\n\nexport default function App() {\n  const revalidator = useRevalidator();\n\n  return (\n    <HygraphInspector\n      endpoint=\"your-endpoint\"\n      onSave={() => revalidator.revalidate()}\n    >\n      {/* Your content */}\n    </HygraphInspector>\n  );\n}";case"vanilla":return"\n// Vanilla JS setup:\nimport { Inspector } from '@hygraph/inspector-sdk';\n\nconst inspector = new Inspector({\n  endpoint: 'your-endpoint'\n});\n\ninspector.subscribe('save', {\n  callback: () => window.location.reload()\n});";default:return`\n// ${this.detectedFramework.type} setup:\nimport { Inspector } from '@hygraph/inspector-sdk';\n\nconst inspector = new Inspector({\n  endpoint: 'your-endpoint'\n});\n\ninspector.subscribe('save', {\n  callback: () => {\n    // Add framework-specific refresh logic here\n    window.location.reload();\n  }\n});`}}},exports.Inspector=s,exports.MessageBridge=t,exports.OverlayManager=n,exports.default=s;
//# sourceMappingURL=index.cjs.js.map
